<?php $__env->startSection('content'); ?>
<div class="container">
        <div class="verfiy-page">
              <div class="bred1">
                <a href="<?php echo URL::to('/'); ?>" class="bred2">Home</a><img src="assets/img/breadcrumb-arrow.png" class="bred"><a href="#">My Order</a>
              </div>
        </div>
        <div class="col-md-3 pad0">
            <div class="inn_mnu">
              <ul class="in_mnu">     
              <li><a href="<?php echo URL::to('/myorder'); ?>">My Order</a></li>           
                <li><a href="<?php echo URL::to('/edit_profile'); ?>">Edit Profile</a></li>
                <li class="active"><a href="<?php echo URL::to('/address_book'); ?>">Address Book</a></li>
                </li> 
                
                </li>             
            </ul>
        </div>
    </div>

    <div class="col-md-9 ">
        <div class="col-md-12">
            <p style="font-size:24px;color:#3e3e3e;">Address Book</p>
            <?php if(Session::has('success')): ?> <p class="error_msg"> <?php echo Session::get('success'); ?> </p> <?php endif; ?>
            <hr>

            <?php
                foreach($address as $address_details)
                {
                    $latitude       = $address_details->latitude;
                    $longitude      = $address_details->longitude;
                    $address_key    = $address_details->address_key;
                    ?>
                     <div class="col-md-10">
                        <p class="add_wdth"><?= $address_details->address ?></p>                    
                    </div>
                    <div class="col-md-2 add_del_sec">
                        <a id="edit_popup" href="javascript:void(0);" onclick="addaddress_popup('<?php echo $address_details->address_key; ?>','<?php echo $address_details->id; ?>');"><img src="<?php echo URL::to('assets/images/edit_icn.png'); ?>" class="ed_icn"></a>
                        <button id="del" onclick="del_address('<?php echo $address_details->address_key; ?>','<?php echo $address_details->customer_id; ?>')"></button>
                        <input type="hidden" name="latitude1" id="latitude2" value="<?= $address_details->latitude ?>">
                        <input type="hidden" name="longitude1" id="longitude2" value="<?= $address_details->longitude ?>">    
                    </div>
                    <div class="clr"></div>
                    <hr>
                    <?php
                }
            ?>  
        </div>
        <div class="col-md-12">
            <a href="#" class="add_plus" data-toggle="modal" data-target="#add-modal">Add</a>
        </div>
    </div>
    <div class="clr"></div>
</div>

<!--Edit Address Modal Dialog-->
<div class="modal fade" id="edit-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content add_picker">
        </div>
    </div>
</div> 


<!--Address Modal Dialog-->
<div class="modal fade" id="add-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="loginmodal-container">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
            <h1>Address Book</h1>
            <br>
            <?php echo Form::open(array('url' => '/addaddress', 'files' => 1)); ?>

                <textarea class="fg" cols="50" rows="4" name="address" id="address" placeholder="User Address"></textarea>
                <input type="hidden" name="latitude" id="latitude">
                <input type="hidden" name="longitude" id="longitude">               
                <div style='overflow:hidden;height:440px;width:100%;'>
                    <div id="map-canvas" style='height:440px;width:700px;'></div>
                    <style>
                        #map-canvas img {
                            max-width: none!important;
                            background: none!important
                        }
                    </style>
                </div>
                <div class="checkbox" style="margin-bottom:15px;margin-top:15px;">
                  <input type="checkbox" name="default" id="default" class="css-checkbox" />
                  <label for="default" class="css-label-chekup">Set This as Default Location
                  </label>
               </div>
                <script type='text/javascript'>
                    $(document).ready(function()
                    {                      
                         if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(GetAddress);
    }
function GetAddress(position) {
	$("#latitude").val(position.coords.latitude);
    $("#longitude").val(position.coords.longitude);
    var lat = parseFloat(position.coords.latitude);
    var lng = parseFloat(position.coords.longitude);
    var latlng = new google.maps.LatLng(lat, lng);
    var geocoder = geocoder = new google.maps.Geocoder();
    geocoder.geocode({ 'latLng': latlng }, function (results, status) {
    if (status == google.maps.GeocoderStatus.OK) {
        if (results[1]) {
            $("#address").val(results[1].formatted_address);
        }
    }
    });
}
	var latitude = $("#latitude").val();
	var longitude = $("#longitude").val();
    $('#map-canvas').locationpicker({
		location: {
        latitude: 24.7136, longitude: 46.6753}
      ,
      radius: 300,
      inputBinding: {
		latitudeInput: $('#latitude'),
        longitudeInput: $('#longitude'),  
        locationNameInput: $('#address')       
      }
});


                        $('#add-modal').on('shown.bs.modal', function () {
                                 $('#map-canvas').locationpicker('autosize');
                        });
         
                    });
                </script>
                <input type="submit" name="login" class="deliver-btn" value="Save" style="margin-top:15px;">
            <?php echo Form::close(); ?>   


        </div>
    </div>
</div>
    
<!--End of Address Modal Dialog-->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script>
        $('#myTab a').click(function(e) {
            e.preventDefault()
            $(this).tab('show')
        })
    </script>

    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
   <!--  <script src="js/bootstrap.min.js"></script> -->
    <script type="text/javascript">   


      /* Delete Address */
      function del_address(key,id)
      {
        var customer_id   = id;
        var address_key   = key;
        if (confirm('Are you sure you want to delete this?')) {
            $.ajax({
                beforeSend : function() {
                    $("body").addClass("loading");
                },
                type : "GET",
                dataType : "html",
                url  : "<?php echo URL::to('/delete_address'); ?>",
                data : {'customer_id':customer_id,'address_key':address_key},
                success: function(result) {
                            if(result=='success')
                            {
                                $("body").removeClass("loading");
                                location.reload();
                            }
                        }
                });
        }
      }

      /* Add Address Popup */
      function addaddress_popup(key,id)
      {
        $.ajax({
                beforeSend: function () {
                    $("body").addClass("loading");
                },
                type: "GET",
                url: "<?php echo URL::to('/addaddress_popup'); ?>",
                data: {'id': id,'address_key':key},
                async: true,
                success: function (result) {
						$("body").removeClass("loading");
						$('.add_picker').html(result);
						$("#edit-modal").modal('show');
                }
            }); 
      }

    $(document).ready(function()
    {
        $('#edit-modal').on('shown.bs.modal', function () {
            $('#edit-canvas').locationpicker('autosize');
        });
   });
    </script>
<?php $__env->stopSection(); ?>

<?php echo $__env->make('header', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>